<html><head><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/image.min.css"></head><body><div class="container"><div class="row"><div class="col-md-10 col-md-offset-1 ui image"><p class="lead"><p>Getting a website is not that easy huh?</p><p>You might be wondering what else we might possibly need to do after all that. There's just one last thing. When we were coding and testing our Flask website, it was nice to use a simple database like SQLite. But SQLite is a file-based database. This is its strength and weakness. It's a strength because while we're coding up our database and debugging, it's really useful to be able to open the SQLite file using DB&nbsp;Viewer and see how our data looks.</p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-13-03-2e5d6a8a93057612885b4389439e16bd.png"></figure><p>But it's also a weakness because once it's deployed with Heroku the file locations are shifted around every 24 hours or so. This means that your database might just get wiped every day. That will mean some very unhappy users. <a href="https://devcenter.heroku.com/articles/sqlite3" rel="noopener noreferrer" target="_blank">Read more here.</a></p><p>So we've got to put on our big-boy/big-girl pants and upgrade our simple SQLite database to PosgreSQL, a database that can handle millions of data entries and reliably delivers data to users.</p><p>Luckily, because we used SQLAlchemy to create our Flask app, there's nothing we need to change in terms of code. We just need to set up the PostgreSQL database and tell Heroku about it.</p><p><br></p><p>1. Go to your app's dashboard on Heroku and go to the Resources tab. Then search for Heroku Postgres.</p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-15-04-46bcd2c3d26ece72afe3aaaad2ee35c0.png"></figure><p>Next, you will see a popup, keep the free-tier and click Submit. </p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-15-56-1a9f8acec44404d7ca78057b08bddf5a.png"></figure><p><br></p><p>Next, we need to connect to this Heroku Postgres database instead of the local SQLite database.</p><p>2. Go to Settings -&gt; Reveal Config Vars</p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-17-52-aaef3aad6d1118f35f2e59683d8edbf4.png"></figure><p><br></p><p>This is the same as our .env file, it's where you can put top secret stuff like API keys and passwords. Then you give it a variable name and you can tap into the value using <code>os.environ.get("VAR_NAME")</code> .</p><p>You'll see that we already have the Postgres database convifg var set up. We just need to connect to it from our code file.</p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-21-21-f7eb3f417c2898ba600332447159e317.png"></figure><p>3. Copy the name of the database config var (mine is <code>DATABASE_URL</code>) and add it to your main.py instead of the sqlite URL.</p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-23-35-9dfef26ff778832bf066a4497817814a.png"></figure><p><br></p><p>4. Let's move our SECRET_KEY into the config var as well. </p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-26-20-653579be44aba7d15d5badc36f6db15f.png"></figure><p><br></p><p>5. SQLite is pre-installed for all Python projects, but if we are going to use Postgres, we'll need to install the <a href="https://pypi.org/project/psycopg2-binary/" rel="noopener noreferrer" target="_blank">psycopg2-binary</a> packages as well. Note, you'll also need to add the package name and version to requirements.txt as well as commit and push the updates.</p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-27_15-36-21-8ca9bb89ef76cb2fb2e6bf17f02c9ac5.gif"></figure><p><br></p><p>Important, make sure that you don't include any pipfile or pipfile.lock files in your GitHub repo (you can delete them and commit the changes). Heroku needs to know which packages they should install on their side</p><p><br></p><p>Because our main.py SQLAlchemy database is now pointing to an environment variable that is only avilable on Heroku, if you run the app right now locally, you will get some errors.</p><p>Instead, we want to provide SQLite as the alternative when we're developing the app locally. </p><p><br></p><p>5. Update the app config to use "DATABASE_URL" environment variable if provided, but if it's None (e.g. when running locally) then we can provide sqlite:///blog.db as the alternative.</p><pre class="prettyprint linenums">app.config['SQLALCHEMY_DATABASE_URI'] = os.environ.get("DATABASE_URL",  "sqlite:///blog.db")</pre><p><br></p><p>Finally, if you go to your heroku app, it should now be up and using a Postgres database.</p><p>Whoohoo! Congratulations if you got this far!</p><p><br></p><p>Also, check out my version:</p><p><a href="https://angela-blog.herokuapp.com/" rel="noopener noreferrer" target="_blank">https://angela-blog.herokuapp.com/</a></p></p></div></div></div></body></html>